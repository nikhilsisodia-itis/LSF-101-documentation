# The Linux Boot Process

## 1. The Boot Process

### 1.1 What is the Boot Process?

- The Linux boot process is the procedure for initializing the system.
- It consists of everything that happens from when the computer power is first switched on until the user interface is fully operational.

### 1.2 Stages of the Boot Process

#### 1.2.1 Stage 1- BIOS

- When the computer is powered on, the Basic Input/Output System (BIOS) initializes the hardware, including the screen and keyboard, and tests the main memory.
- This process is also called POST (Power On Self Test).
- The BIOS software is stored on a read-only memory (ROM) chip on the motherboard.
- After this, the remainder of the boot process is controlled by the operating system (OS).

#### 1.2.2 Stage 2- Master Boot Record (MBR), EFI Partition, and Boot Loader

- Once the POST is completed, system control passes from the BIOS to the boot loader.
- The boot loader is usually stored on one of the system’s storage devices, such as a hard disk or SSD drive, either in the boot sector (for traditional BIOS/MBR systems) or the EFI partition (for more recent (Unified) Extensible Firmware Interface or EFI/UEFI systems).
- A number of boot loaders exist for Linux, the most common ones are:
  - GRUB (for GRand Unified Boot loader).
  - ISOLINUX (for booting from removable media).
  - DAS U-Boot (for booting on embedded devices/appliances).
- Most Linux boot loaders can present a user interface for choosing alternative options for booting Linux and even other operating systems that might be installed.
- When booting Linux, the boot loader is responsible for loading the kernel image and the initial RAM disk or filesystem (which contains some critical files and device drivers needed to start the system) into memory.

#### 1.2.3 Stage 3- Boot Loader in Action

- The boot loader has two distinct stages:
  
- For systems using the BIOS/MBR method:
  - The boot loader resides at the first sector of the hard disk, also known as the Master Boot Record (MBR).
  - The size of the MBR is just 512 bytes.
  - In this stage, the boot loader examines the partition table and finds a bootable partition.
  - Once it finds a bootable partition, it then searches for the second stage boot loader, for example GRUB, and loads it into RAM (Random Access Memory).
- For systems using the EFI/UEFI method:
  - UEFI firmware reads its Boot Manager data to determine which UEFI application is to be launched and from where (i.e., from which disk and partition the EFI partition can be found).
  - The firmware then launches the UEFI application, for example GRUB, as defined in the boot entry in the firmware's boot manager.
  - This procedure is more complicated but more versatile than the older MBR methods.

- The second stage boot loader resides under /boot.
- A splash screen is displayed, which allows users to choose which operating system (OS) and/or kernel to boot.
- After the OS and kernel are selected, the boot loader loads the kernel of the operating system into RAM and passes control to it.
- Kernels are almost always compressed, so the first job they have is to uncompress themselves.
- After this, they will check and analyze the system hardware and initialize any hardware device drivers built into the kernel.

#### 1.2.4 Stage 4- initramfs

- After the kernel has been loaded and initialized, it mounts a temporary root filesystem called initramfs (initial RAM filesystem).
- The initramfs contains a minimal set of directories and executables to perform further system initialization tasks, such as loading additional device drivers needed to access the real root filesystem on the disk.
- Once these tasks are completed, the initramfs is cleared from RAM, and the init program on the root filesystem `/sbin/init` is executed.
- `initramfs` contains -> `Programs and Binaries` that -> `Help the Kernel to Load Necessary Drivers` -> `Mount the Real Root Filesystem` -> `Switch from initramfs to the Real Root Filesystem`.

#### 1.2.5 Stage 5- init/Systemd

- The init program is the first process started by the Linux kernel and is responsible for bringing the system to a usable state.
- Traditionally, the init program used in Linux systems is the System V init (SysVinit).
- However, many modern Linux distributions have adopted systemd as the init system due to its advanced features and parallel service startup capabilities.
- The init or systemd process reads its configuration files to determine which services and processes need to be started.
- It then starts these services, mounts filesystems, and performs other necessary tasks to prepare the system for user interaction.
- Once all the required services are started, the init/systemd process hands over control to the login manager or graphical user interface (GUI), allowing users to log in and start using the system.

### 1.3 Kernel, init, and Services

#### 1.3.1 The Kernel

- The boot loader loads both the kernel and an initial RAM–based file system (initramfs) into memory, so it can be used directly by the kernel.
When the kernel is loaded in RAM, it immediately initializes and configures the computer’s memory and also configures all the hardware attached to the system.
- This includes all processors, I/O subsystems, storage devices, etc.
- The kernel also loads some necessary user space applications and device drivers from the initramfs into memory.

#### 1.3.2 /sbin/init and Services

- Once the kernel has set up all its hardware and mounted the root filesystem, the kernel runs /sbin/init.
- This then becomes the initial process, which then starts other processes to get the system running.
- Most other processes on the system trace their origin ultimately to init, exceptions include the so-called kernel processes.
- These are started by the kernel directly, and their job is to manage internal operating system details.
- Besides starting the system, init is responsible for keeping the system running and for shutting it down cleanly.
- One of its responsibilities is to act when necessary as a manager for all non-kernel processes; it cleans up after them upon completion, and restarts user login services as needed when users log in and out, and does the same for other background system services.
- This serial process (called SysVinit) had the system pass through a sequence of runlevels containing collections of scripts that start and stop services.
- Each runlevel supported a different mode of running the system.
- Within each runlevel, individual services could be set to run, or to be shut down if running.
- However, all major distributions have moved away from this sequential method of system initialization, and now use `systemd`, which can start services in parallel, significantly speeding up the boot process.
